services:
  # ── redstne Dashboard ──────────────────────────────────────────────────
  dashboard:
    # image: ghcr.io/redstne/dash:latest
    # Uncomment to build locally instead:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3001:3001"
    environment:
      NODE_ENV: production
      DB_PATH: /data/redstne.db
      # Set BASE_URL to your public URL when not running on localhost
      BASE_URL: ${BASE_URL:-http://localhost:3001}
      # Auto-seed the bundled Minecraft server — remove if managing servers manually
      MC_SERVER_1_NAME: ${MC_SERVER_1_NAME:-Minecraft}
      MC_SERVER_1_HOST: dash-minecraft-1.dash_redstne
      MC_SERVER_1_PORT: 25575
      MC_SERVER_1_PASSWORD: ${MC_RCON_PASSWORD:?MC_RCON_PASSWORD is required}
      MC_SERVER_1_LOG_PATH: /data/mc/logs/latest.log
    volumes:
      - ./data:/data
      - minecraft_data:/data/mc  # shared access to MC server files
    restart: unless-stopped
    networks:
      - redstne

  # ── Sample Minecraft Server (dev/demo) ───────────────────────────────────
  minecraft:
    image: itzg/minecraft-server:latest
    environment:
      EULA: "TRUE"
      MEMORY: 4G
      ENABLE_RCON: "true"
      RCON_PASSWORD: ${MC_RCON_PASSWORD:?MC_RCON_PASSWORD is required}
      RCON_PORT: 25575
      TYPE: PAPER
      VERSION: LATEST
      # redstne.dash managed plugin list — updated automatically when plugins are installed
      PLUGINS_FILE: /data/redstne-plugins.txt
    ports:
      - "25565:25565"
      - "25575:25575"
    volumes:
      - minecraft_data:/data
    restart: unless-stopped
    networks:
      - redstne

volumes:
  minecraft_data:

networks:
  redstne:
    driver: bridge
