services:
  # ── RedstnKit Dashboard ──────────────────────────────────────────────────
  dashboard:
    # image: ghcr.io/redstnkit/dash:latest
    # Uncomment to build locally instead:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3001:3001"
    environment:
      NODE_ENV: production
      PORT: 3001
      BASE_URL: ${BASE_URL:-http://localhost:3001}
      CORS_ORIGIN: ${CORS_ORIGIN:-http://localhost:3001}
      BETTER_AUTH_SECRET: ${BETTER_AUTH_SECRET:?BETTER_AUTH_SECRET is required}
      ENCRYPTION_KEY: ${ENCRYPTION_KEY:?ENCRYPTION_KEY is required (64 hex chars)}
      # Initial admin bootstrap (Postgres-style: direct value or *_FILE for Docker secrets)
      REDSTNKIT_ADMIN_EMAIL: ${REDSTNKIT_ADMIN_EMAIL:-}
      REDSTNKIT_ADMIN_EMAIL_FILE: ${REDSTNKIT_ADMIN_EMAIL_FILE:-}
      REDSTNKIT_ADMIN_PASSWORD: ${REDSTNKIT_ADMIN_PASSWORD:-}
      REDSTNKIT_ADMIN_PASSWORD_FILE: ${REDSTNKIT_ADMIN_PASSWORD_FILE:-}
      REDSTNKIT_ADMIN_NAME: ${REDSTNKIT_ADMIN_NAME:-Admin}
      DB_PATH: /data/redstnkit.db
      # Set to "true" when running behind an HTTPS reverse proxy
      SECURE_COOKIES: ${SECURE_COOKIES:-false}
      # Path where Minecraft server files are volume-mounted
      SERVER_FILES_ROOT: /data/servers
      # Path to Minecraft server log (auto-configured when using the built-in MC service)
      MC_LOG_PATH: /data/mc/logs/latest.log
    volumes:
      - ./data:/data
      - minecraft_data:/data/mc  # shared access to MC server files
      # Optional: mount your rclone config for Proton Drive, Google Drive, etc.
      # - ${RCLONE_CONFIG:-./data/rclone.conf}:/root/.config/rclone/rclone.conf:ro
    restart: unless-stopped
    networks:
      - redstnkit

  # ── Sample Minecraft Server (dev/demo) ───────────────────────────────────
  minecraft:
    image: itzg/minecraft-server:latest
    environment:
      EULA: "TRUE"
      MEMORY: 2G
      ENABLE_RCON: "true"
      RCON_PASSWORD: ${MC_RCON_PASSWORD:?MC_RCON_PASSWORD is required}
      RCON_PORT: 25575
      TYPE: PAPER
      VERSION: LATEST
    ports:
      - "25565:25565"
      - "25575:25575"
    volumes:
      - minecraft_data:/data
    restart: unless-stopped
    networks:
      - redstnkit

volumes:
  minecraft_data:

networks:
  redstnkit:
    driver: bridge
